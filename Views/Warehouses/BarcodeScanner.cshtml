@{
    ViewData["Title"] = "Barkod Tarayıcı";
}

<div class="page-container">
    <div class="section-header">
        <h1 class="section-title">📷 Barkod Tarayıcı</h1>
        <a href="/Warehouses" class="btn btn-secondary">← Geri Dön</a>
    </div>

    <div class="cards-container" style="max-width: 600px; margin: 0 auto;">
        <div style="text-align: center; margin-bottom: 32px;">
            <div style="font-size: 64px; margin-bottom: 16px;">📷</div>
            <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 8px;">Barkod Okuyucu</h3>
            <p style="color: var(--text-secondary);">Barkod okutun veya manuel girin</p>
        </div>

        <div class="form-group">
            <label class="form-label">🔍 Barkod</label>
            <input type="text"
                   id="barcodeInput"
                   class="form-control"
                   placeholder="Barkod okutun veya yazın"
                   autofocus
                   onkeypress="if(event.key === 'Enter') searchBarcode()">
        </div>

        <button class="btn btn-primary" style="width: 100%;" onclick="searchBarcode()">
            🔍 Ara
        </button>

        <div id="productInfo" style="display: none; margin-top: 24px; padding: 20px; background: var(--bg-main); border-radius: 12px;">
            <h4 style="font-size: 16px; font-weight: 700; margin-bottom: 16px;">📦 Ürün Bilgisi</h4>
            <div id="productDetails"></div>

            <h4 style="font-size: 16px; font-weight: 700; margin: 24px 0 16px;">🏭 Depo Stokları</h4>
            <div id="stockDetails"></div>
        </div>
    </div>
</div>

<script>
    async function searchBarcode() {
        const barcode = document.getElementById('barcodeInput').value.trim();

        if (!barcode) {
            alert('Lütfen barkod girin');
            return;
        }

        try {
            const formData = new FormData();
            formData.append('barcode', barcode);

            const response = await fetch('/Warehouses/SearchBarcode', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();

            if (data.success) {
                document.getElementById('productInfo').style.display = 'block';

                document.getElementById('productDetails').innerHTML = `
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <div><strong>Ürün Kodu:</strong> ${data.product.code}</div>
                        <div><strong>Ürün Adı:</strong> ${data.product.name}</div>
                        <div><strong>Barkod:</strong> ${data.product.barcode}</div>
                        <div><strong>Fiyat:</strong> ${data.product.price} TL</div>
                    </div>
                `;

                let stockHtml = '';
                data.stocks.forEach(stock => {
                    stockHtml += `
                        <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--bg-card); border-radius: 8px; margin-bottom: 8px;">
                            <span>${stock.warehouseName}</span>
                            <strong style="color: var(--success);">${stock.quantity} adet</strong>
                        </div>
                    `;
                });

                document.getElementById('stockDetails').innerHTML = stockHtml || '<p style="color: var(--text-secondary);">Bu ürün hiçbir depoda bulunmuyor</p>';
            } else {
                alert(data.message);
                document.getElementById('productInfo').style.display = 'none';
            }
        } catch (error) {
            alert('Bir hata oluştu');
            console.error(error);
        }
    }
</script>